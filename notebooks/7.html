
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>8. Model Assessment &#8212; Food Desert Classification</title>
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Model Visualization" href="8.html" />
    <link rel="prev" title="7. Deep Learning Modeling" href="6.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>Food Desert Classification</span></a></h1>
        <h2 class="heading"><span>8. Model Assessment</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="6.html">7. Deep Learning Modeling</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="8.html">9. Model Visualization</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="model-assessment">
<h1>8. Model Assessment<a class="headerlink" href="#model-assessment" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from keras.models import load_model
import pickle
import pandas as pd
import numpy as np
from sklearn.metrics import confusion_matrix, precision_score, classification_report, roc_curve, auc, roc_auc_score
import matplotlib.pyplot as plt
from sklearn.preprocessing import LabelEncoder
from sklearn.linear_model import LogisticRegression
# fix rng seed
seed = 42
np.random.seed(seed)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">TensorFlow</span> <span class="n">backend</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset = pd.read_pickle(&quot;../data/production/imputed_dataset.pickle&quot;)
Y = dataset[&quot;USDA Model&quot;]
X = dataset.drop(&quot;USDA Model&quot;, axis=&quot;columns&quot;)
x = X.values
# encode response as 1/0
encoded_Y = LabelEncoder().fit_transform(Y.values)
</pre></div>
</div>
<div class="section" id="import-saved-models">
<h2>8.1. Import Saved Models<a class="headerlink" href="#import-saved-models" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>nadam = load_model(&quot;../models/nadam.h5&quot;)
adamax = load_model(&quot;../models/adamax.h5&quot;)
with open(&quot;../models/logreg.pickle&quot;, &quot;rb&quot;) as modelfile:
    logreg = pickle.load(modelfile)
</pre></div>
</div>
<pre class="literal-block">WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py:3445: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use <cite>rate</cite> instead of <cite>keep_prob</cite>. Rate should be set to <cite>rate = 1 - keep_prob</cite>.
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:3066: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.</pre>
</div>
<div class="section" id="logistic-regression">
<h2>8.2. Logistic Regression<a class="headerlink" href="#logistic-regression" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>logreg.score(X,Y)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.8238892466194462</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y_pred = logreg.predict(X)
confusion_matrix(encoded_Y, y_pred)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">2505</span><span class="p">,</span>   <span class="mi">45</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">502</span><span class="p">,</span>   <span class="mi">54</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(classification_report(encoded_Y, y_pred))
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

           <span class="mi">0</span>       <span class="mf">0.83</span>      <span class="mf">0.98</span>      <span class="mf">0.90</span>      <span class="mi">2550</span>
           <span class="mi">1</span>       <span class="mf">0.55</span>      <span class="mf">0.10</span>      <span class="mf">0.16</span>       <span class="mi">556</span>

    <span class="n">accuracy</span>                           <span class="mf">0.82</span>      <span class="mi">3106</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.69</span>      <span class="mf">0.54</span>      <span class="mf">0.53</span>      <span class="mi">3106</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.78</span>      <span class="mf">0.82</span>      <span class="mf">0.77</span>      <span class="mi">3106</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>y_score = logreg.decision_function(X)
fpr, tpr, _ = roc_curve(Y,y_score)
roc_auc = auc(fpr, tpr)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure()
lw = 2
plt.plot(fpr, tpr, color=&#39;darkorange&#39;,
         lw=lw, label=&#39;ROC curve (area = %0.2f)&#39; % roc_auc)
plt.plot([0, 1], [0, 1], color=&#39;navy&#39;, lw=lw, linestyle=&#39;--&#39;)
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel(&#39;False Positive Rate&#39;)
plt.ylabel(&#39;True Positive Rate&#39;)
plt.title(&#39;Receiver operating characteristic example&#39;)
plt.legend(loc=&quot;lower right&quot;)
plt.show()
</pre></div>
</div>
<img alt="../_images/output_10_0.png" src="../_images/output_10_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset[&quot;Logistic Regression&quot;] = y_pred
</pre></div>
</div>
</div>
<div class="section" id="neural-networks">
<h2>8.3. Neural Networks<a class="headerlink" href="#neural-networks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adamax-optimizer">
<h3>8.3.1. Adamax Optimizer<a class="headerlink" href="#adamax-optimizer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ypred = adamax.predict(x).round()
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>confusion_matrix(encoded_Y, ypred)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">2512</span><span class="p">,</span>   <span class="mi">38</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">496</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>precision_score(encoded_Y, ypred)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.9288389513108615</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(classification_report(encoded_Y, ypred))
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

           <span class="mi">0</span>       <span class="mf">0.98</span>      <span class="mf">0.99</span>      <span class="mf">0.98</span>      <span class="mi">2550</span>
           <span class="mi">1</span>       <span class="mf">0.93</span>      <span class="mf">0.89</span>      <span class="mf">0.91</span>       <span class="mi">556</span>

    <span class="n">accuracy</span>                           <span class="mf">0.97</span>      <span class="mi">3106</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.95</span>      <span class="mf">0.94</span>      <span class="mf">0.95</span>      <span class="mi">3106</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mi">3106</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fpr, tpr, _ = roc_curve(encoded_Y, ypred)
roc_auc = auc(fpr, tpr)
plt.figure()
lw = 2
plt.plot(fpr, tpr, color=&#39;darkorange&#39;,
         lw=lw, label=&#39;ROC curve (area = %0.2f)&#39; % roc_auc)
plt.plot([0, 1], [0, 1], color=&#39;navy&#39;, lw=lw, linestyle=&#39;--&#39;)
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel(&#39;False Positive Rate&#39;)
plt.ylabel(&#39;True Positive Rate&#39;)
plt.title(&#39;Receiver operating characteristic example&#39;)
plt.legend(loc=&quot;lower right&quot;)
plt.show()
</pre></div>
</div>
<img alt="../_images/output_17_0.png" src="../_images/output_17_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset[&quot;Adamax&quot;] = ypred == 1
</pre></div>
</div>
</div>
<div class="section" id="nadam-optimizer">
<h3>8.3.2. Nadam Optimizer<a class="headerlink" href="#nadam-optimizer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ypred2 = nadam.predict(x).round()
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>confusion_matrix(encoded_Y, ypred2)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">2526</span><span class="p">,</span>   <span class="mi">24</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">69</span><span class="p">,</span>  <span class="mi">487</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>precision_score(encoded_Y, ypred2)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.9530332681017613</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(classification_report(encoded_Y, ypred2))
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

           <span class="mi">0</span>       <span class="mf">0.97</span>      <span class="mf">0.99</span>      <span class="mf">0.98</span>      <span class="mi">2550</span>
           <span class="mi">1</span>       <span class="mf">0.95</span>      <span class="mf">0.88</span>      <span class="mf">0.91</span>       <span class="mi">556</span>

    <span class="n">accuracy</span>                           <span class="mf">0.97</span>      <span class="mi">3106</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.96</span>      <span class="mf">0.93</span>      <span class="mf">0.95</span>      <span class="mi">3106</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mf">0.97</span>      <span class="mi">3106</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fpr, tpr, _ = roc_curve(encoded_Y, ypred)
roc_auc = auc(fpr, tpr)
plt.figure()
lw = 2
plt.plot(fpr, tpr, color=&#39;darkorange&#39;,
         lw=lw, label=&#39;ROC curve (area = %0.2f)&#39; % roc_auc)
plt.plot([0, 1], [0, 1], color=&#39;navy&#39;, lw=lw, linestyle=&#39;--&#39;)
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel(&#39;False Positive Rate&#39;)
plt.ylabel(&#39;True Positive Rate&#39;)
plt.title(&#39;Receiver operating characteristic example&#39;)
plt.legend(loc=&quot;lower right&quot;)
plt.show()
</pre></div>
</div>
<img alt="../_images/output_24_0.png" src="../_images/output_24_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset[&quot;Nadam&quot;] = ypred2 == 1
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset.to_pickle(&quot;../models/predictions.pickle&quot;)
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="6.html">7. Deep Learning Modeling</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="8.html">9. Model Visualization</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Noah B Johnson &amp; Tristan Shaffer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>